<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins" />
<title>Cart - Camera Rental</title>
<link rel="stylesheet" href="/path_to_your_css_file.css"> <!-- Link your existing CSS file here -->
<style>
/*navbar*/
.navbar {
    background-color: #000459;
    overflow: hidden;
    border-radius: 0.5em;
  }
  
  .navbar a {
    float: left;
    display: block;
    color: rgb(255, 255, 255);
    text-align: center;
    padding: 14px 20px;
    text-decoration: none;
  }

  .dropdown {
    float: left;
    overflow: hidden;
  }

  .dropdown .dropbtn {
    cursor: pointer;
    font-size: 16px;    
    border: none;
    outline: none;
    color: rgb(255, 255, 255);
    padding: 14px 16px;
    background-color: inherit;
    font-family: inherit;
    margin: 0;
  }

  .navbar a:hover, .dropdown:hover .dropbtn {
    background-color: rgb(154, 156, 154);
  }

  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
  }

  .dropdown-content a {
    float: none;
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .dropdown-content a:hover {
    background-color: #ddd;
  }

  .dropdown:hover .dropdown-content {
    display: block;
  }

  .shop-name {
  background-color: white;
  color: black;
  border-radius: 0.5em;
  font-size: 17px;
  font-weight: 600;
  padding: 1em 2em;
  cursor: pointer;
  transition: all 0.3s ease-in-out;
  border: 1px solid black;
  box-shadow: 0 0 0 0 black;
  text-align: center;
  font-family: 'Poppins';
  }

  .shop-name:hover:hover {
  transform: translateY(-1px) ;
  box-shadow: 2px 3px 0 0 black;
};

.shop-name:active {
  transform: translateY(2px) translateX(1px);
  box-shadow: 0 0 0 0 black;
};

  /*end of navbar*/

  .date-time-container {
    display: flex;
    justify-content: space-between;
    margin-bottom: 50px;
  }

  .date-time-box {
    padding: 20px;
    margin: 5px 5px;
    background-color: #D7B377;
    /* Additional styling */
  }

  .days-count {
    padding: 10px;
    background-color: #8F754F;
    color: white;
    /* Additional styling */
  }

  .cart-item {
    background-color: #f0f0f0; /* Light grey background */
    padding: 10px;
    margin-bottom: 10px;
    /* Additional styling */
  }

  .delete-button {
    background-color: green;
    color: white;
    padding: 10px;
    cursor: pointer;
    /* Additional styling */
  }

  .delete-button:hover {
    background-color: #98fb98; /* Lighter green */
  }

  .total-price {
    background-color: #8F754F;
    color: white;
    padding: 10px;
    /* Additional styling */
  }

  .submit-button {
margin: 10px;
 padding: 10px 25px;
 border: unset;
 border-radius: 15px;
 color: #212121;
 z-index: 1;
 background: #e8e8e8;
 position: relative;
 font-weight: 1000;
 font-size: 17px;
 -webkit-box-shadow: 4px 8px 19px -3px rgba(0,0,0,0.27);
 box-shadow: 4px 8px 19px -3px rgba(0,0,0,0.27);
 transition: all 250ms;
 overflow: hidden;
}

.submit-button::before {
 content: "";
 position: absolute;
 top: 0;
 left: 0;
 height: 100%;
 width: 0;
 border-radius: 15px;
 background-color: #212121;
 z-index: -1;
 -webkit-box-shadow: 4px 8px 19px -3px rgba(0,0,0,0.27);
 box-shadow: 4px 8px 19px -3px rgba(0,0,0,0.27);
 transition: all 250ms
}

.submit-button:hover {
 color: #e8e8e8;
}

.submit-button:hover::before {
 width: 100%;
}

  /* ... Any additional custom styles ... */
</style>



</head>
<body>
    <div class="shopname">
        <div class="shop-name" onclick="location.href='/'">Shuli Camera Rent</div>
    
      <div class="navbar">
        <div class="dropdown">
          <button class="dropbtn">Camera</button>
          <div class="dropdown-content">
            <a href="/camera-rental/canoncam">Canon</a>
            <a href="/camera-rental/sonycam">Sony</a>
          </div>
        </div> 
        <div class="dropdown">
          <button class="dropbtn">Lenses</button>
          <div class="dropdown-content">
            <a href="/camera-rental/canonlens">Canon</a>
            <a href="/camera-rental/sonylens">Sony</a>
          </div>
        </div> 
        <div class="login">
          <a href="/camera-rental/account">Login or create account</a>
        </div>
        <div class="cart">
          <a href="/camera-rental/cart">Cart</a>
        </div>
  </div>

  <div class="date-time-container">
    <div class="date-time-box">
      Rent date <input type="date" id="rentDate">
      <select id="rentTime">
        <option value="session1">Session 1 (9AM-3PM)</option>
        <option value="session2">Session 2 (3PM-9PM)</option>
      </select>
    </div>
    <div class="date-time-box">
      Return date <input type="date" id="returnDate">
      <select id="returnTime">
        <option value="session1">Session 1 (9AM-3PM)</option>
        <option value="session2">Session 2 (3PM-9PM)</option>
      </select>
    </div>
    <div class="days-count">
      Days count <span id="daysCount">1.5 days (example)</span>
    </div>
  </div>

 
  <div id="cartItemsContainer">
    <div class="cart-item">
        <button class="delete-button" onclick="deleteItem(this)">delete</button>
        Gear name: R5 <br>
        Quantity: <input type="number" value="${productDetails.quantity}" min="1" onchange="updateQuantity('${productName}', this.value)"><br>
        Price: Â¥1,300
      </div>
  </div>
  
  <!-- Repeat for other cart items -->

  <div class="total-price">
    Total Price <span id="totalPrice">Total Price</span>
  </div>

  <button class="submit-button" onclick="submitOrder()">SUBMIT</button>

  <script>
    // Function to load and display the cart items
    function loadCartItems() {
    const cartItemsContainer = document.getElementById('cartItemsContainer');
    const cart = JSON.parse(localStorage.getItem('cart')) || {};
    let totalPrice = 0;
    let daysCount = calculateDaysCount();

    cartItemsContainer.innerHTML = '';

    Object.entries(cart).forEach(([productName, productDetails]) => {
        let itemTotalPrice = productDetails.quantity * productDetails.price * daysCount;
        totalPrice += itemTotalPrice;

        const cartItemHtml = `
            <div class="cart-item">
                <button class="delete-button" onclick="deleteItem('${productName}')">delete</button>
                Gear name: ${productName} <br>
                Quantity: ${productDetails.quantity} <br>
                Price: NTD${productDetails.price} <br>
                Total: NTD${itemTotalPrice}
            </div>
        `;
        cartItemsContainer.innerHTML += cartItemHtml;
    });

    document.getElementById('totalPrice').textContent = `Total Price: NTD${totalPrice}`;
}

// Function to calculate the days count based on selections
function calculateDaysCount() {
    const rentDateValue = document.getElementById('rentDate').value;
    const returnDateValue = document.getElementById('returnDate').value;
    if (!rentDateValue || !returnDateValue) {
        return 0; // Return 0 days if dates are not set
    }
    const rentDate = new Date(rentDateValue);
    const returnDate = new Date(returnDateValue);
    if (isNaN(rentDate.getTime()) || isNaN(returnDate.getTime())) {
        return 0; // Return 0 days if dates are invalid
    }
    const timeDiff = returnDate.getTime() - rentDate.getTime();
    return Math.ceil(timeDiff / (1000 * 3600 * 24));
}


// Add event listeners for the date and time inputs
document.getElementById('rentDate').addEventListener('change', () => {
    calculateDays();
    loadCartItems(); // Recalculate total price when dates change
});
document.getElementById('rentTime').addEventListener('change', () => {
    calculateDays();
    loadCartItems(); // Recalculate total price when dates change
});
document.getElementById('returnDate').addEventListener('change', () => {
    calculateDays();
    loadCartItems(); // Recalculate total price when dates change
});
document.getElementById('returnTime').addEventListener('change', () => {
    calculateDays();
    loadCartItems(); // Recalculate total price when dates change
});

// Call the function to load items and calculate total price on page load
window.addEventListener('DOMContentLoaded', () => {
    calculateDays();
    loadCartItems();
});
  
    // Function to delete an item from the cart
    function deleteItem(productName) {
      const cart = JSON.parse(localStorage.getItem('cart')) || {};
      if (cart.hasOwnProperty(productName)) {
        delete cart[productName];
        localStorage.setItem('cart', JSON.stringify(cart));
        loadCartItems();
      }
    }
  
    // Function to update the quantity of a cart item
    function updateQuantity(productName, quantity) {
      let cart = JSON.parse(localStorage.getItem('cart')) || {};
      if (cart.hasOwnProperty(productName) && Number(quantity) >= 1) {
        cart[productName].quantity = Number(quantity);
        localStorage.setItem('cart', JSON.stringify(cart));
        loadCartItems(); // Refresh the cart display
      }
    }
  
    // Function to submit the order
    function submitOrder() {
  // Check if the user is logged in
  fetch('/check_login_status/')
  .then(response => response.json())
  .then(data => {
    if (data.is_logged_in) {
      // User is logged in, proceed to submit the order
      const cart = JSON.parse(localStorage.getItem('cart')) || {};
      fetch('/submit_order/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({cart: cart}),
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          window.location.href = data.order_url;
        } else {
          alert('There was an error submitting your order. Please try again.');
        }
      });
    } else {
      // User is not logged in, redirect to account page
      window.location.href = '/camera-rental/account';
    }
  });
}


// Utility function to get the CSRF token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
  
    // Function to calculate the days count based on selections
    function calculateDays() {
      // Placeholder for your calculation logic
      const rentDate = new Date(document.getElementById('rentDate').value);
      const returnDate = new Date(document.getElementById('returnDate').value);
      const timeDiff = returnDate.getTime() - rentDate.getTime();
      const daysCount = Math.ceil(timeDiff / (1000 * 3600 * 24));
      document.getElementById('daysCount').textContent = daysCount + ' days';
    }
  
    // Add event listeners for the date and time inputs
    document.getElementById('rentDate').addEventListener('change', calculateDays);
    document.getElementById('rentTime').addEventListener('change', calculateDays);
    document.getElementById('returnDate').addEventListener('change', calculateDays);
    document.getElementById('returnTime').addEventListener('change', calculateDays);
  
    // Load the cart items when the page is fully loaded
    window.addEventListener('DOMContentLoaded', loadCartItems);
  </script>
    

</body>
</html>
